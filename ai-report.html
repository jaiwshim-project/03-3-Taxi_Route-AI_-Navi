<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 전략 리포트 — 택시빈차내비AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.min.css">
  <link rel="stylesheet" href="css/custom.css">
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col">

<!-- 헤더 -->
<div id="app-header"></div>

<!-- 메인 콘텐츠 -->
<main class="flex-1 max-w-5xl mx-auto w-full px-4 sm:px-6 py-8">

  <!-- 리포트 헤더 -->
  <div class="bg-gradient-to-br from-amber-500 via-orange-500 to-red-500 rounded-2xl p-8 mb-8 text-white animate-fade-in-up">
    <div class="flex items-start justify-between flex-wrap gap-4">
      <div>
        <div class="flex items-center gap-3 mb-3">
          <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center text-2xl">&#x1F4CA;</div>
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold">AI 일일 전략 리포트</h1>
            <p class="text-amber-100 text-sm mt-0.5" id="report-date"></p>
          </div>
        </div>
        <p class="text-amber-100 text-sm max-w-xl" id="report-subtitle">택시빈차내비AI가 택시 수요 데이터를 분석하여 생성한 맞춤형 운행 전략 리포트입니다. 데이터 기반 의사결정으로 수익을 극대화하세요.</p>
      </div>
      <div class="flex gap-3 items-center">
        <select id="reportCitySelect" onchange="onReportCityChange(this.value)"
                class="rounded-lg bg-white/20 backdrop-blur border border-white/30 px-3 py-2 text-sm font-medium text-white outline-none cursor-pointer hover:bg-white/30 transition">
        </select>
        <button onclick="window.print()" class="px-4 py-2 bg-white/20 backdrop-blur rounded-lg text-sm font-medium hover:bg-white/30 transition no-print">&#x1F5A8; 인쇄</button>
      </div>
    </div>
  </div>

  <!-- 리포트 본문 -->
  <div id="report-body" class="space-y-8">
    <!-- JS로 생성 -->
    <div class="flex items-center justify-center py-20"><div class="spinner"></div><span class="ml-3 text-gray-500">AI 리포트 생성 중...</span></div>
  </div>

</main>

<!-- 푸터 -->
<div id="app-footer"></div>

<!-- 스크립트 -->
<script src="js/mock-data.js"></script>
<script src="js/shared.js"></script>
<script src="js/demand-engine.js"></script>
<script>
  initPage('report');

  // 도시 선택 드롭다운 채우기
  var reportCitySel = document.getElementById('reportCitySelect');
  Object.keys(CITY_DATA).forEach(function(key) {
    var opt = document.createElement('option');
    opt.value = key;
    opt.textContent = CITY_DATA[key].name;
    if (key === 'seoul') opt.selected = true;
    reportCitySel.appendChild(opt);
  });

  var currentReportCity = 'seoul';

  function onReportCityChange(cityKey) {
    currentReportCity = cityKey;
    switchCity(cityKey);
    document.getElementById('report-body').innerHTML =
      '<div class="flex items-center justify-center py-20"><div class="spinner"></div><span class="ml-3 text-gray-500">AI 리포트 생성 중...</span></div>';
    setTimeout(function() { generateReport(); }, 500);
  }

  generateReport();

function generateReport() {

  var now = new Date();
  var hour = now.getHours();
  var dow = now.getDay();
  var weather = 'clear';
  var dayNames = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
  var dateStr = now.getFullYear() + '년 ' + (now.getMonth() + 1) + '월 ' + now.getDate() + '일 ' + dayNames[dow];
  var cityName = CITY_DATA[currentReportCity] ? CITY_DATA[currentReportCity].name : '서울특별시';
  document.getElementById('report-date').textContent = dateStr + ' | ' + cityName + ' | 자동 생성 리포트';

  // 데이터 준비
  var districtDemand = aggregateDistrictDemand(hour, dow, weather);
  var dailySim = simulateRevenue('ai', 10, HOTSPOTS, weather);
  var monthly = estimateMonthlyIncome('ai');

  // 핫스팟 점수 계산
  var scoredSpots = HOTSPOTS.map(function(hs) {
    var score = calculateDemandScore(hs, hour, dow, weather);
    return { spot: hs, score: score };
  });
  scoredSpots.sort(function(a, b) { return b.score - a.score; });

  // 시간대별 최적 시간 분석
  var hourlyScores = [];
  for (var h = 0; h < 24; h++) {
    var totalScore = 0;
    HOTSPOTS.forEach(function(hs) {
      totalScore += calculateDemandScore(hs, h, dow, weather);
    });
    hourlyScores.push({ hour: h, avgScore: Math.round(totalScore / HOTSPOTS.length) });
  }
  hourlyScores.sort(function(a, b) { return b.avgScore - a.avgScore; });

  // 시뮬레이션 로딩 효과
  setTimeout(function() {
    renderReport();
  }, 800);

  function renderReport() {
    var sections = [];

    /* ═══ 1. 오늘의 수요 예측 요약 ═══ */
    var topDistrict = districtDemand[0];
    var avgDemand = Math.round(districtDemand.reduce(function(sum, d) { return sum + d.avgScore; }, 0) / districtDemand.length);
    var demandLevel = avgDemand >= 70 ? '매우 높음' : avgDemand >= 55 ? '높음' : avgDemand >= 40 ? '보통' : '낮음';
    var demandColor = avgDemand >= 70 ? 'text-red-600' : avgDemand >= 55 ? 'text-orange-600' : avgDemand >= 40 ? 'text-yellow-600' : 'text-green-600';

    sections.push(
      '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fade-in-up">' +
        '<div class="flex items-center gap-3 mb-5">' +
          '<div class="w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center text-xl">&#x1F4CB;</div>' +
          '<div><h2 class="text-lg font-bold text-gray-900">1. 오늘의 수요 예측 요약</h2><p class="text-xs text-gray-400">Demand Forecast Summary</p></div>' +
        '</div>' +
        '<div class="grid sm:grid-cols-3 gap-4 mb-5">' +
          '<div class="bg-amber-50 rounded-xl p-4 text-center border border-amber-100">' +
            '<p class="text-sm text-gray-600 mb-1">전체 수요 수준</p>' +
            '<p class="text-2xl font-bold ' + demandColor + '">' + demandLevel + '</p>' +
            '<p class="text-xs text-gray-500 mt-1">평균 점수: ' + avgDemand + '/100</p>' +
          '</div>' +
          '<div class="bg-orange-50 rounded-xl p-4 text-center border border-orange-100">' +
            '<p class="text-sm text-gray-600 mb-1">최고 수요 지역</p>' +
            '<p class="text-xl font-bold text-orange-700">' + topDistrict.name + '</p>' +
            '<p class="text-xs text-gray-500 mt-1">수요 점수: ' + topDistrict.avgScore + '점</p>' +
          '</div>' +
          '<div class="bg-yellow-50 rounded-xl p-4 text-center border border-yellow-100">' +
            '<p class="text-sm text-gray-600 mb-1">예상 일일 순수익</p>' +
            '<p class="text-xl font-bold text-yellow-700">' + fmtWon(dailySim.netIncome) + '</p>' +
            '<p class="text-xs text-gray-500 mt-1">AI 최적화 기준</p>' +
          '</div>' +
        '</div>' +
        '<div class="bg-gray-50 rounded-xl p-4">' +
          '<p class="text-sm text-gray-700 leading-relaxed">' +
            '&#x1F4A1; <strong>분석 요약:</strong> 오늘(' + dayNames[dow] + ') ' + cityName + ' 전체 택시 수요는 <strong class="' + demandColor + '">' + demandLevel + '</strong> 수준으로 예측됩니다. ' +
            '<strong>' + topDistrict.name + '</strong> 지역이 평균 ' + topDistrict.avgScore + '점으로 가장 높은 수요를 보이며, ' +
            '핵심 거점은 <strong>' + (topDistrict.topSpot || '-') + '</strong>입니다. ' +
            'AI 최적화 운행 시 일일 순수익 약 <strong>' + fmtWon(dailySim.netIncome) + '</strong>이 예상됩니다.' +
          '</p>' +
        '</div>' +
      '</div>'
    );

    /* ═══ 2. 추천 운행 시간대 ═══ */
    var topHours = hourlyScores.slice(0, 6);
    var goldHours = topHours.slice(0, 3);
    var silverHours = topHours.slice(3, 6);

    var hourBarsHTML = '';
    for (var hb = 0; hb < 24; hb++) {
      var hScore = hourlyScores.find(function(hs) { return hs.hour === hb; });
      var score = hScore ? hScore.avgScore : 0;
      var maxAvg = hourlyScores[0].avgScore;
      var pct = Math.max(8, Math.round((score / maxAvg) * 100));
      var isGold = goldHours.some(function(gh) { return gh.hour === hb; });
      var isSilver = silverHours.some(function(sh) { return sh.hour === hb; });
      var barCls = isGold ? 'bg-orange-500' : isSilver ? 'bg-amber-400' : 'bg-gray-300';
      hourBarsHTML += '<div class="flex-1 flex flex-col items-center justify-end h-full group relative">' +
        '<div class="absolute -top-7 bg-gray-800 text-white text-xs px-2 py-0.5 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-10">' + formatHour(hb) + ' (' + score + '점)</div>' +
        '<div class="w-full rounded-t ' + barCls + '" style="height:' + pct + '%;min-height:3px"></div>' +
        (hb % 3 === 0 ? '<span class="text-[10px] text-gray-400 mt-1">' + hb + '</span>' : '') +
      '</div>';
    }

    sections.push(
      '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fade-in-up">' +
        '<div class="flex items-center gap-3 mb-5">' +
          '<div class="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center text-xl">&#x23F0;</div>' +
          '<div><h2 class="text-lg font-bold text-gray-900">2. 추천 운행 시간대</h2><p class="text-xs text-gray-400">Recommended Operating Hours</p></div>' +
        '</div>' +
        '<div class="flex items-end gap-[2px] h-36 mb-4">' + hourBarsHTML + '</div>' +
        '<div class="flex items-center gap-4 text-xs text-gray-500 mb-5">' +
          '<span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-orange-500 inline-block"></span> 최적 시간대 (골드)</span>' +
          '<span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-amber-400 inline-block"></span> 우수 시간대 (실버)</span>' +
          '<span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-gray-300 inline-block"></span> 일반</span>' +
        '</div>' +
        '<div class="grid sm:grid-cols-2 gap-4">' +
          '<div class="border border-orange-200 bg-orange-50 rounded-xl p-4">' +
            '<h3 class="font-bold text-orange-800 mb-2">&#x1F31F; 골드 타임 (최우선 추천)</h3>' +
            '<ul class="space-y-1">' + goldHours.map(function(gh) {
              return '<li class="text-sm text-gray-700">&#x2022; <strong>' + formatHour(gh.hour) + ' ~ ' + formatHour((gh.hour + 1) % 24) + '</strong> — 평균 수요 ' + gh.avgScore + '점</li>';
            }).join('') + '</ul>' +
          '</div>' +
          '<div class="border border-amber-200 bg-amber-50 rounded-xl p-4">' +
            '<h3 class="font-bold text-amber-800 mb-2">&#x2B50; 실버 타임 (추천)</h3>' +
            '<ul class="space-y-1">' + silverHours.map(function(sh) {
              return '<li class="text-sm text-gray-700">&#x2022; <strong>' + formatHour(sh.hour) + ' ~ ' + formatHour((sh.hour + 1) % 24) + '</strong> — 평균 수요 ' + sh.avgScore + '점</li>';
            }).join('') + '</ul>' +
          '</div>' +
        '</div>' +
      '</div>'
    );

    /* ═══ 3. TOP 5 핫스팟 추천 ═══ */
    var top5 = scoredSpots.slice(0, 5);
    var reasonMap = {
      '교통': '교통 허브로 유동인구가 집중되며 장거리 탑승 비율이 높습니다.',
      '업무': '퇴근 시간대 비즈니스 수요가 폭발적으로 증가합니다.',
      '유흥': '심야 시간대 안정적인 수요와 높은 요금이 기대됩니다.',
      '상업': '쇼핑·외식 수요로 오후~저녁 지속적 탑승이 발생합니다.',
      '관광': '관광객 이동 수요로 중·장거리 탑승이 많습니다.',
      '시장': '새벽 시장 물류·상인 이동으로 독점적 수요를 확보할 수 있습니다.',
      '주거': '출퇴근 시간대 안정적인 통근 수요를 제공합니다.',
      '문화': '공연·전시 종료 후 대규모 탑승 수요가 발생합니다.'
    };

    var top5HTML = top5.map(function(item, idx) {
      var hs = item.spot;
      var score = item.score;
      var grade = getDemandGrade(score);
      var reason = reasonMap[hs.type] || '수요가 높은 핵심 지역입니다.';
      return '<div class="flex gap-4 p-4 rounded-xl border border-gray-100 hover:border-amber-200 hover:bg-amber-50/30 transition">' +
        '<div class="w-12 h-12 bg-amber-500 text-white rounded-xl flex items-center justify-center text-lg font-bold shrink-0">' + (idx + 1) + '</div>' +
        '<div class="flex-1 min-w-0">' +
          '<div class="flex items-center gap-2 flex-wrap">' +
            '<h3 class="font-bold text-gray-900">' + hs.name + '</h3>' +
            '<span class="px-2 py-0.5 rounded-full text-xs font-bold ' + grade.color + '">' + grade.grade + '등급 (' + score + '점)</span>' +
            '<span class="px-2 py-0.5 rounded-full text-xs bg-gray-100 text-gray-600">' + hs.type + '</span>' +
          '</div>' +
          '<p class="text-sm text-gray-600 mt-1">' + hs.district + ' | 피크타임: ' + hs.peakHour + ' | 평균요금: ' + fmt(hs.avgFare) + '원</p>' +
          '<p class="text-sm text-gray-500 mt-1">&#x1F4A1; ' + reason + '</p>' +
        '</div>' +
      '</div>';
    }).join('');

    sections.push(
      '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fade-in-up">' +
        '<div class="flex items-center gap-3 mb-5">' +
          '<div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center text-xl">&#x1F4CD;</div>' +
          '<div><h2 class="text-lg font-bold text-gray-900">3. TOP 5 핫스팟 추천</h2><p class="text-xs text-gray-400">Top Performing Hotspots</p></div>' +
        '</div>' +
        '<div class="space-y-3">' + top5HTML + '</div>' +
      '</div>'
    );

    /* ═══ 4. 구역별 전략 ═══ */
    var topDistricts = districtDemand.slice(0, 8);
    var strategyMap = {
      '강남구': '퇴근 러시 (18~20시)에 역삼·선릉 업무지구 집중 배치 후, 21시 이후 논현·압구정 유흥지역으로 전환하세요.',
      '중구': '오전 서울역 교통허브 + 오후 명동 상업지구 조합으로 종일 높은 탑승률을 유지할 수 있습니다.',
      '영등포구': '여의도 IFC 퇴근 수요 (17~20시)를 선점하세요. 장거리 탑승 확률이 높습니다.',
      '서초구': '고속터미널 주변은 종일 안정적입니다. 교대역~서초역 법조타운 퇴근 수요도 공략하세요.',
      '마포구': '홍대입구 심야 수요 (21~03시)가 핵심입니다. 낮에는 DMC·합정 일대를 커버하세요.',
      '송파구': '잠실역(롯데월드) 저녁 수요를 기본으로, 가락시장 새벽 수요를 보조로 활용하세요.',
      '종로구': '광화문 퇴근 + 종각 심야 유흥 수요의 시간대 전환 전략이 효과적입니다.',
      '용산구': '용산역 출퇴근 + 이태원 심야 수요를 양분 공략하세요.'
    };
    var defaultStrategy = '해당 구역 핫스팟의 피크타임에 맞춰 배치하고, 비수요 시간에는 인근 고수요 구역으로 이동하세요.';

    var districtCardsHTML = topDistricts.map(function(dist, idx) {
      var strategy = strategyMap[dist.name] || defaultStrategy;
      var grade = getDemandGrade(dist.avgScore);
      return '<div class="border border-gray-100 rounded-xl p-4 hover:border-amber-200 transition">' +
        '<div class="flex items-center justify-between mb-2">' +
          '<div class="flex items-center gap-2">' +
            '<span class="text-sm font-bold text-amber-600">#' + (idx + 1) + '</span>' +
            '<h3 class="font-bold text-gray-900">' + dist.name + '</h3>' +
            '<span class="px-2 py-0.5 rounded-full text-xs font-bold ' + grade.color + '">' + grade.grade + ' (' + dist.avgScore + ')</span>' +
          '</div>' +
          '<span class="text-xs text-gray-400">핫스팟 ' + dist.count + '개</span>' +
        '</div>' +
        '<p class="text-sm text-gray-600 mb-2">핵심 거점: <strong>' + (dist.topSpot || '-') + '</strong> (최고 ' + dist.maxScore + '점)</p>' +
        '<div class="bg-amber-50 rounded-lg p-3">' +
          '<p class="text-sm text-gray-700">&#x1F3AF; <strong>전략:</strong> ' + strategy + '</p>' +
        '</div>' +
      '</div>';
    }).join('');

    sections.push(
      '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fade-in-up">' +
        '<div class="flex items-center gap-3 mb-5">' +
          '<div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-xl">&#x1F5FA;</div>' +
          '<div><h2 class="text-lg font-bold text-gray-900">4. 구역별 전략</h2><p class="text-xs text-gray-400">District-Level Strategies</p></div>' +
        '</div>' +
        '<div class="grid sm:grid-cols-2 gap-4">' + districtCardsHTML + '</div>' +
      '</div>'
    );

    /* ═══ 5. 날씨 영향 분석 ═══ */
    var weatherTypes = [
      { key: 'clear', label: '맑음', icon: '&#x2600;&#xFE0F;', mult: WEATHER_WEIGHTS['clear'] },
      { key: 'cloudy', label: '흐림', icon: '&#x26C5;', mult: WEATHER_WEIGHTS['cloudy'] },
      { key: 'rain', label: '비', icon: '&#x1F327;&#xFE0F;', mult: WEATHER_WEIGHTS['rain'] },
      { key: 'heavy_rain', label: '폭우', icon: '&#x26C8;&#xFE0F;', mult: WEATHER_WEIGHTS['heavy_rain'] },
      { key: 'snow', label: '눈', icon: '&#x2744;&#xFE0F;', mult: WEATHER_WEIGHTS['snow'] }
    ];

    var weatherBarHTML = weatherTypes.map(function(w) {
      var pctW = Math.round(w.mult * 100);
      var sim = simulateRevenue('ai', 10, HOTSPOTS, w.key);
      return '<div class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition">' +
        '<span class="text-2xl w-10 text-center">' + w.icon + '</span>' +
        '<span class="text-sm font-medium text-gray-700 w-16">' + w.label + '</span>' +
        '<div class="flex-1 bg-gray-100 rounded-full h-5 overflow-hidden">' +
          '<div class="h-full rounded-full bg-gradient-to-r from-amber-400 to-orange-500" style="width:' + Math.min(100, pctW) + '%"></div>' +
        '</div>' +
        '<span class="text-sm font-bold w-14 text-right text-amber-700">x' + w.mult.toFixed(2) + '</span>' +
        '<span class="text-xs text-gray-500 w-20 text-right">' + fmtWon(sim.netIncome) + '</span>' +
      '</div>';
    }).join('');

    sections.push(
      '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fade-in-up">' +
        '<div class="flex items-center gap-3 mb-5">' +
          '<div class="w-10 h-10 bg-sky-100 rounded-xl flex items-center justify-center text-xl">&#x1F326;&#xFE0F;</div>' +
          '<div><h2 class="text-lg font-bold text-gray-900">5. 날씨 영향 분석</h2><p class="text-xs text-gray-400">Weather Impact Analysis</p></div>' +
        '</div>' +
        '<div class="space-y-1 mb-4">' + weatherBarHTML + '</div>' +
        '<div class="bg-sky-50 rounded-xl p-4 border border-sky-100">' +
          '<p class="text-sm text-gray-700 leading-relaxed">&#x1F4A1; <strong>날씨 전략:</strong> ' +
          '비 오는 날 수요가 <strong class="text-orange-600">+35%</strong>, 폭우 시 <strong class="text-red-600">+55%</strong>까지 증가합니다. ' +
          '우천 시에는 대중교통 밀집 지역(역 주변)과 주거단지를 집중 공략하세요. ' +
          '눈 오는 날은 수요 <strong class="text-blue-600">+45%</strong> 증가하지만 사고 위험이 높으므로 안전 운행을 병행해야 합니다.</p>' +
        '</div>' +
      '</div>'
    );

    /* ═══ 6. 주간 수익 예측 ═══ */
    var weekDays = ['월', '화', '수', '목', '금', '토', '일'];
    var weekDow = [1, 2, 3, 4, 5, 6, 0];
    var weeklyTotal = 0;
    var weekRevRows = weekDow.map(function(wd, idx) {
      var wSim = simulateRevenue('ai', 10, HOTSPOTS, idx === 4 ? 'rain' : 'clear');
      var dayNet = Math.round(wSim.netIncome * DAY_WEIGHTS[wd]);
      weeklyTotal += dayNet;
      var isHighlight = DAY_WEIGHTS[wd] >= 1.1;
      return '<tr class="' + (isHighlight ? 'bg-amber-50/50' : '') + '">' +
        '<td class="py-3 px-4 text-sm font-medium">' + weekDays[idx] + '요일</td>' +
        '<td class="py-3 px-4 text-sm text-center">x' + DAY_WEIGHTS[wd].toFixed(2) + '</td>' +
        '<td class="py-3 px-4 text-sm text-center">' + wSim.totalTrips + '건</td>' +
        '<td class="py-3 px-4 text-sm text-right font-bold text-amber-700">' + fmtWon(dayNet) + '</td>' +
      '</tr>';
    }).join('');

    sections.push(
      '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fade-in-up">' +
        '<div class="flex items-center gap-3 mb-5">' +
          '<div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center text-xl">&#x1F4B0;</div>' +
          '<div><h2 class="text-lg font-bold text-gray-900">6. 주간 수익 예측</h2><p class="text-xs text-gray-400">Weekly Revenue Forecast</p></div>' +
        '</div>' +
        '<div class="overflow-x-auto mb-4">' +
          '<table class="w-full">' +
            '<thead><tr class="border-b-2 border-gray-200">' +
              '<th class="py-2 px-4 text-left text-sm text-gray-600">요일</th>' +
              '<th class="py-2 px-4 text-center text-sm text-gray-600">수요 계수</th>' +
              '<th class="py-2 px-4 text-center text-sm text-gray-600">예상 운행</th>' +
              '<th class="py-2 px-4 text-right text-sm text-gray-600">예상 순수익</th>' +
            '</tr></thead>' +
            '<tbody>' + weekRevRows + '</tbody>' +
            '<tfoot><tr class="border-t-2 border-amber-300 bg-amber-50">' +
              '<td colspan="3" class="py-3 px-4 font-bold text-gray-900">주간 총 예상 순수익</td>' +
              '<td class="py-3 px-4 text-right font-bold text-xl text-amber-700">' + fmtWon(weeklyTotal) + '</td>' +
            '</tr></tfoot>' +
          '</table>' +
        '</div>' +
        '<div class="bg-emerald-50 rounded-xl p-4 border border-emerald-100">' +
          '<p class="text-sm text-gray-700">&#x1F4A1; <strong>금요일·토요일</strong>이 수요 계수가 가장 높습니다. 특히 금요일 저녁 유흥지역(홍대·강남·종각)의 심야 수요를 적극 공략하면 일일 수익을 20% 이상 높일 수 있습니다.</p>' +
        '</div>' +
      '</div>'
    );

    /* ═══ 7. 개선 제안사항 ═══ */
    var suggestions = [
      {
        icon: '&#x1F3AF;',
        title: '피크타임 선점 전략',
        desc: '핵심 핫스팟에 피크타임 10~15분 전 도착하여 대기하면 경쟁 차량 대비 탑승 확률이 40% 이상 증가합니다. 강남역(17:45), 홍대입구(20:45), 서울역(06:45) 사전 배치를 권장합니다.',
        priority: '높음',
        pColor: 'text-red-600 bg-red-50'
      },
      {
        icon: '&#x1F504;',
        title: '구역 순환 동선 최적화',
        desc: '빈차 이동 시간을 최소화하려면 강남→서초→영등포→마포→종로 순환 동선을 기본으로 하고, 시간대별로 핫스팟 밀집도가 높은 방향으로 조정하세요.',
        priority: '높음',
        pColor: 'text-red-600 bg-red-50'
      },
      {
        icon: '&#x1F327;&#xFE0F;',
        title: '기상 변화 선제 대응',
        desc: '기상청 예보를 미리 확인하고, 우천 시작 30분 전에 역 주변 및 주거 밀집지역으로 이동하세요. 우천 초반 30분이 수요 폭발 구간입니다.',
        priority: '중간',
        pColor: 'text-amber-600 bg-amber-50'
      },
      {
        icon: '&#x1F4F1;',
        title: 'AI 리포트 일일 활용',
        desc: '매일 운행 시작 전 AI 리포트를 확인하고, TOP 5 핫스팟과 골드타임을 기반으로 당일 운행 계획을 수립하세요. 데이터 기반 운행은 경험 기반 대비 약 25% 수익 향상 효과가 있습니다.',
        priority: '중간',
        pColor: 'text-amber-600 bg-amber-50'
      },
      {
        icon: '&#x26FD;',
        title: '연료비 절감',
        desc: '빈차 운행 거리를 줄이는 것이 가장 효과적인 연료비 절감 방법입니다. AI 경로 최적화를 활용하면 빈차 거리를 평균 30% 줄일 수 있으며, 월 약 ' + fmtWon(Math.round(monthly.monthlyFuel * 0.3)) + '의 연료비가 절약됩니다.',
        priority: '보통',
        pColor: 'text-green-600 bg-green-50'
      }
    ];

    var suggestionsHTML = suggestions.map(function(s) {
      return '<div class="border border-gray-100 rounded-xl p-5 hover:border-amber-200 transition">' +
        '<div class="flex items-start gap-3">' +
          '<span class="text-2xl">' + s.icon + '</span>' +
          '<div class="flex-1">' +
            '<div class="flex items-center gap-2 mb-1 flex-wrap">' +
              '<h3 class="font-bold text-gray-900">' + s.title + '</h3>' +
              '<span class="px-2 py-0.5 rounded-full text-xs font-bold ' + s.pColor + '">우선순위: ' + s.priority + '</span>' +
            '</div>' +
            '<p class="text-sm text-gray-600 leading-relaxed">' + s.desc + '</p>' +
          '</div>' +
        '</div>' +
      '</div>';
    }).join('');

    sections.push(
      '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fade-in-up">' +
        '<div class="flex items-center gap-3 mb-5">' +
          '<div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center text-xl">&#x1F4A1;</div>' +
          '<div><h2 class="text-lg font-bold text-gray-900">7. 개선 제안사항</h2><p class="text-xs text-gray-400">AI Improvement Suggestions</p></div>' +
        '</div>' +
        '<div class="space-y-4">' + suggestionsHTML + '</div>' +
      '</div>'
    );

    /* ── 리포트 푸터 ── */
    sections.push(
      '<div class="text-center py-6 text-sm text-gray-400">' +
        '<p>본 리포트는 택시빈차내비AI의 수요 예측 엔진이 자동 생성하였습니다.</p>' +
        '<p class="mt-1">데이터 기준: ' + dateStr + ' ' + formatHour(hour) + ' | 날씨 조건: 맑음 | 분석 핫스팟: ' + HOTSPOTS.length + '개</p>' +
      '</div>'
    );

    document.getElementById('report-body').innerHTML = sections.join('');
  }
}
</script>
</body>
</html>
